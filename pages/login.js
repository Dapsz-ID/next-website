import { useState } from 'react'; import Layout from '@/components/Layout'
export default function Login(){ const [username,setUser]=useState(''); const [password,setPass]=useState(''); const [msg,setMsg]=useState('')
const submit=async(e)=>{ e.preventDefault(); const res = await fetch('/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,password})}); const data = await res.json(); if(data.success){ const me = {username:data.user.username,role:data.user.role,verified:data.user.verified,avatar:data.user.avatar,banner:data.user.banner}; localStorage.setItem('me', JSON.stringify(me)); localStorage.setItem('user', me.username); setMsg('Login berhasil'); location.href='/dashboard'; return } const local = JSON.parse(localStorage.getItem('localUsers')||'[]'); const found = local.find(u=>u.username===username && u.password===password); if(found){ const me = { username: found.username, role: found.role||'user', verified: !!found.verified, avatar: found.avatar||'/default-avatar.png', banner: found.banner||'' }; localStorage.setItem('me', JSON.stringify(me)); localStorage.setItem('user', me.username); location.href='/dashboard'; return } setMsg(data.message||'Login gagal') }
return (<Layout><div className='container py-16'><div className='max-w-md mx-auto card'><h1 className='text-2xl font-bold'>Login</h1><form onSubmit={submit} className='mt-4 space-y-3'><input className='w-full border rounded-xl p-2' placeholder='Username' value={username} onChange={e=>setUser(e.target.value)} /><input type='password' className='w-full border rounded-xl p-2' placeholder='Password' value={password} onChange={e=>setPass(e.target.value)} /><button className='btn btn-primary w-full'>Masuk</button></form>{msg && <p className='text-sm text-red-600 mt-3'>{msg}</p>}</div></div></Layout>) }
