import { useEffect, useState } from 'react'; import Layout from '@/components/Layout'
export default function Dashboard(){ const [me,setMe]=useState(null); const [snips,setSnips]=useState([]); useEffect(()=>{ const m = JSON.parse(localStorage.getItem('me')||'null'); if(!m){ location.href='/login'; return } setMe(m); fetch('/api/snippets').then(r=>r.json()).then(seed=>{ const local = JSON.parse(localStorage.getItem('snippets')||'[]'); setSnips(seed.concat(local.filter(l=>!seed.find(s=>s.id===l.id)))) }); fetch('/api/users').then(r=>r.json()).then(u=> localStorage.setItem('seedUsers', JSON.stringify(u)) ) },[])
const saveProfile=(e)=>{ e.preventDefault(); const avatar = e.target.avatar.value; const banner = e.target.banner.value; const local = JSON.parse(localStorage.getItem('localUsers')||'[]'); const idx = local.findIndex(x=>x.username===me.username); if(idx===-1) local.push({username:me.username,password:'',role:me.role,verified:me.verified,avatar,banner,followers:me.followers||0}); else { local[idx].avatar=avatar; local[idx].banner=banner } localStorage.setItem('localUsers', JSON.stringify(local)); localStorage.setItem('localProfiles', JSON.stringify(local)); alert('Profile updated'); location.reload() }
const deleteSnippet=(id)=>{ let local = JSON.parse(localStorage.getItem('snippets')||'[]'); local = local.filter(s=>s.id!==id); localStorage.setItem('snippets', JSON.stringify(local)); const removed = JSON.parse(localStorage.getItem('removedSeed')||'[]'); removed.push(id); localStorage.setItem('removedSeed', JSON.stringify(removed)); setSnips(prev=>prev.filter(s=>s.id!==id)); alert('Deleted') }
return (<Layout><div className='container py-12'><h1 className='text-3xl font-bold'>Dashboard</h1><p className='mt-2'>Welcome, <span className='font-semibold'>{me?.username}</span> ({me?.role})</p><div className='mt-6 grid md:grid-cols-2 gap-6'><div className='card'><h2 className='text-xl font-semibold'>Edit Profile</h2><form className='mt-4 space-y-3' onSubmit={saveProfile}><input name='avatar' placeholder='Avatar URL' className='w-full border rounded-xl p-2'/><input name='banner' placeholder='Banner URL' className='w-full border rounded-xl p-2'/><button className='btn btn-primary'>Save</button></form></div><div className='card'><h2 className='text-xl font-semibold'>My Snippets</h2><div className='mt-4 space-y-3'>{snips.filter(s=>s.author===me?.username).map(s=>(<div key={s.id} className='border p-3 rounded'><div className='font-semibold'>{s.title}</div><div className='text-sm text-gray-500'>id: {s.id}</div><div className='mt-2'><button onClick={()=>{ navigator.clipboard.writeText(location.origin + '/codeshare/' + s.id); alert('Link copied') }} className='btn btn-outline mr-2'>Copy Link</button><button onClick={()=>{ let arr=JSON.parse(localStorage.getItem('snippets')||'[]'); arr=arr.filter(x=>x.id!==s.id); localStorage.setItem('snippets', JSON.stringify(arr)); location.reload() }} className='btn btn-primary'>Delete</button></div></div>))}</div></div>{me?.role==='admin' && <div className='mt-6 card'><h2 className='text-xl font-semibold'>Admin Moderation</h2><div className='mt-4 space-y-3'><p>Manage seeded snippets and users from dashboard (client-side)</p></div></div>}</div></Layout>) }
